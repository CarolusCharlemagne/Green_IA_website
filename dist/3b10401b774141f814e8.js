document.addEventListener("DOMContentLoaded",(function(){const e=document.getElementById("barcode-scanner"),t=document.getElementById("text_result"),n=document.getElementById("ecoscore_image"),i=document.getElementById("img_result");let o=!1,r=null;e.setAttribute("playsinline","true"),e.setAttribute("webkit-playsinline","true"),e.setAttribute("disablePictureInPicture","true"),e.style.objectFit="cover";const c={a:"publique/img/icons/Picto_A.png",b:"publique/img/icons/Picto_B.png",c:"publique/img/icons/Picto_C.png",d:"publique/img/icons/Picto_D.png",e:"publique/img/icons/Picto_E.png"};function a(){n.innerHTML="",i.innerHTML=""}navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:1280},height:{ideal:720}}}).then((function(s){r=s,e.srcObject=r,e.play();const l=r.getVideoTracks()[0];l&&l.getCapabilities&&l.getCapabilities().torch&&l.applyConstraints({advanced:[{torch:!0}]}),r?o?console.log("Le scanner est déjà en cours."):(Quagga.init({inputStream:{name:"Live",type:"LiveStream",target:e,constraints:{facingMode:"environment",width:{ideal:1280},height:{ideal:720}}},decoder:{readers:["ean_reader"]}},(function(e){e?console.error(e):Quagga.start()})),Quagga.onDetected((function(e){if(!o){o=!0;const r=`https://world.openfoodfacts.org/api/v0/product/${e.codeResult.code}.json`;fetch(r).then((e=>e.json())).then((e=>{if(0===e.status)return t.innerText="Produit non trouvé",a(),void(o=!1);let r=e.product,s=r.product_name||"",l=r.brands||"",d=r.ecoscore_score||"0",u=r.ecoscore_grade||"",g=`${s}\n${l}\nOrigine: ${r.origins||""}\nEcoscore: ${d}%`;if(t.innerText=g,u&&c[u.toLowerCase()]){let e=document.createElement("img");e.src=c[u.toLowerCase()],e.alt="Eco-score image",e.style.borderRadius="0.4em",e.style.height="30px",e.style.width="auto",e.style.display="block",e.style.objectFit="scale-down",n.innerHTML="",n.appendChild(e)}if(r.image_url){let e=document.createElement("img");e.src=r.image_url,e.alt="Image du produit",e.style.maxWidth="100%",e.style.height="auto",e.style.display="block",e.style.objectFit="contain",i.innerHTML="",i.appendChild(e)}})).catch((e=>{console.error("Erreur lors de la requête à Open Food Facts:",e),t.innerText="Erreur lors de la requête à Open Food Facts",a()})).finally((()=>{setTimeout((()=>{o=!1}),2e3)}))}}))):console.error("La caméra n'est pas initialisée.")})).catch((function(e){console.error("Erreur lors de l'accès à la caméra:",e)}))}));